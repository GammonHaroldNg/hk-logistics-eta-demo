<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Trip Admin</title>
</head>
<body>
  <h1>Trip Admin</h1>

  <h2>Start trip</h2>
  <label>
    Vehicle ID:
    <input id="start-vehicle-id" value="TRUCK-001" />
  </label>
  <button onclick="startTrip()">Start trip now</button>

  <h2>Mark arrived</h2>
  <label>
    Trip ID:
    <input id="arrive-trip-id" />
  </label>
  <button onclick="arriveTrip()">Mark as arrived</button>

  <h2>Todayâ€™s trips</h2>
  <button onclick="loadTrips()">Refresh</button>
  <pre id="trips-output"></pre>

  <script>
    async function startTrip() {
      const vehicleId = document.getElementById('start-vehicle-id').value;
      const res = await fetch('/api/trips/start', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ vehicleId })
      });
      const data = await res.json();
      alert('Start response: ' + JSON.stringify(data));
      if (data.ok && data.trip && data.trip.id) {
        document.getElementById('arrive-trip-id').value = data.trip.id;
      }
      loadTrips();
    }

    async function arriveTrip() {
      const tripId = document.getElementById('arrive-trip-id').value.trim();
      if (!tripId) {
        alert('Please enter a trip id');
        return;
      }
      const res = await fetch('/api/trips/' + tripId + '/arrive', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({})
      });
      const data = await res.json();
      alert('Arrive response: ' + JSON.stringify(data));
      loadTrips();
    }

    async function loadTrips() {
      const res = await fetch('/api/trips/today');
      const data = await res.json();
      document.getElementById('trips-output').textContent =
        JSON.stringify(data, null, 2);
    }

    loadTrips();
  </script>
</body>
</html>
